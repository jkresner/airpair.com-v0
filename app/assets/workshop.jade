doctype html
html(ng-app='ngAirPair')
  head
    title AirConf | !{ workshop.title }
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='robots', content='index, follow')
    meta(name='HandheldFriendly', content='True')
    meta(name='MobileOptimized', content='320')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0')
    meta(name='author', content='airpair, inc.')
    meta(name='keywords', content=workshop.speakers[0].name)
    meta(name='description', content='One month long virtual Software Conference')
    link(rel='stylesheet', href='/css/ap.css')
    link(rel='stylesheet', type='text/css', href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600')

  body#airconf(ng-controller='SessionController')
    //- .subscribe(style="position: fixed; right: 20px; top: 15px; z-index: 125; text-align: right; float: right; width: 500px;")
    //-   .control-group
    //-     .controls
    //-       .input-prepend
    //-         .scroll(href="#") Hi {{ session.name() }}
    //-         span.add-on(style="color: gray;") Schedule Updates
    //-         input(type="text", name="rake", placeholder="By email", value="", data-error-style="inline", style="width: 220px;")
    //-         button#btnSubscribe.btn.btn-primary(style="height: 30px; margin-top: -4px;") Subscribe
    //- .subscribe(style="width: 100%; height: 70px; background: black; opacity: 0.7; position: fixed; z-index: 112;")

    header
      a(href="/airconf2014",target="_self")
        img(src="/images/landing/airconf/full-logo.png", alt="AirConf")

    div(ng-view)
    //-   .bg-gray(ng-show="session.isSignedIn()")
    //-   .container.p-b-4
    //-     h2.text-thin.text-center.m-t-4 Session Chat
    //-     #chat(ng-controller='ChatController')
    //-       div.row(ng-cloak='ng-cloak', ng-repeat='message in messages')
    //-         .col-xs-1#pic
    //-           img.img-responsive(ng-src="{{message.pic}}")
    //-         .col-xs-11#message
    //-           {{message.content}}
    //-           #timestamp
    //-             strong {{message.from}} &nbsp;
    //-             {{ moment(message.timestamp).fromNow() }}
    //-       div.row
    //-         form.form-inline(ng-submit='addMessage()')
    //-           .col-xs-1#pic
    //-             img.img-responsive(ng-src="{{user.picture}}")
    //-           .col-xs-11#message
    //-             input(type='text', ng-model='message', placeholder='Hit enter to submit message...')

    //- .bg-gray
    //-   .container.p-b-4
    //-     h2.text-thin.text-center.m-t-4 Sponsor
    //-     p(style="margin: 40px; text-align: center;") Twilio

    div(ng-hide="isSignedIn()")
      .modal.fade(id="loginModal", tabindex="-1", role="dialog", aria-labelledby="loginTitle", aria-hidden="true", style="opacity:0.95")
        .modal-dialog
          .modal-content
            .modal-header
              h4.modal-title#loginTitle(style="font-weight:bold;font-size:22px") Attend AirConf 2014
            .modal-body(style="text-align:center;padding:60px")
              p(style="font-size:16px;margin-bottom:60px;") AirConf is broadcasted via Google+ Hangouts
              a.btn.btn-block.btn-orange.btn-signin.trackAirConfLogin(href="#") Sign in with Google to access AirConf
              p(style="font-size:12px;margin:10px 0 0 0") *Your Google email be use to invite you to live workshops.
            .modal-footer
              button(type="button", class="btn btn-default", data-dismiss="modal") Close


    script(src="/javascripts/site.js")
    script(src="/javascripts/airconf.js")
    script(src='https://cdn.firebase.com/v0/firebase.js')
    script(src='https://cdn.firebase.com/libs/angularfire/0.5.0/angularfire.min.js')
    script(type="text/javascript").
      window.session = {
        user: !{ session ? JSON.stringify(session) : 'null'},
        workshop: !{ workshop ? JSON.stringify(workshop) : 'null'},
        requestId: !{ workshopRequestId ? JSON.stringify(workshopRequestId) : 'null'},
        registration: !{ registration ? JSON.stringify(registration) : 'null'}
      };

    script(type="text/javascript").
      function bindLoginModal() {
        if(typeof addjs === 'undefined') {
          var AddJS = require("scripts/providers/addjs/index");
          window.addjs = new AddJS('!{segmentioKey}');
        }
        addjs.trackEvent('page', 'view', window.location.pathname, 'workshop detail');
        addjs.trackSession({});

        $("body").on('click', ".loginRequired", function(e) {
          e.preventDefault();
          var return_to = window.location.pathname;
          if ($(this).data('return')) { return_to = $(this).data('return'); }

          elemId = window.location.pathname + ':' + $(this).attr('id');
          addjs.trackEvent('airconf', 'airconfExplore', elemId);
          $('#loginModal').modal({ keyboard: false });
          $(".trackAirConfLogin").click(function(e) {
            addjs.trackEvent('airconf', 'airconfLogin', elemId);
            addjs.redirectToLogin(e, "auth/google?return_to=" + return_to);
          });
        });
      }
      bindLoginModal();

    script.
      require('scripts/site/workshop');
