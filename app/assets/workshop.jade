doctype html
html(ng-app='ngAirPair')
  head
    title AirConf | #{workshop.title}
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge,chrome=1')
    meta(name='robots', content='index, follow')
    meta(name='HandheldFriendly', content='True')
    meta(name='MobileOptimized', content='320')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0')
    meta(name='author', content='airpair, inc.')
    meta(name='keywords', content=workshop.speakers[0].name)
    meta(name='description', content='One month long virtual Software Conference')
    link(rel="canonical" href="https://www.airpair.com"+reqUrl)
    meta(property='og:url', content="https://www.airpair.com"+reqUrl)
    meta(property='og:image', content='https://www.airpair.com/images/landing/airconf/slides/'+workshop.slug+'.jpg')
    meta(property='og:title', content='AirConf Online Talk | '+workshop.title)
    meta(property='og:description', content=workshop.description)
    link(rel='stylesheet', href='/css/ap.css')
    link(rel='stylesheet', type='text/css', href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600')
    script(src="/javascripts/site.js")
    script(src="/javascripts/airconf.js")
    script(src='//cdn.firebase.com/js/client/1.0.18/firebase.js')
    script(src='//cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js')
    script(src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-519d1944598d7aed")


  body#airconf(ng-controller='SessionController',style="background:black")
    header
      a(href="/airconf2014",target="_self")
        img(src="/images/landing/airconf/full-logo.png", alt="AirConf")

    div(ng-view)

    div(ng-hide="isSignedIn()")
      .modal.fade(id="loginModal", tabindex="-1", role="dialog", aria-labelledby="loginTitle", aria-hidden="true", style="opacity:0.95")
        .modal-dialog
          .modal-content
            .modal-header
              h4.modal-title#loginTitle(style="font-weight:bold;font-size:22px") Attend AirConf 2014
            .modal-body(style="text-align:center;padding:60px")
              p(style="font-size:16px;margin-bottom:60px;") AirConf is broadcasted via Google+ Hangouts
              a.btn.btn-block.btn-orange.btn-signin.trackAirConfLogin(href="#") Sign in with Google to access AirConf
              p(style="font-size:12px;margin:10px 0 0 0") *Your Google email be use to invite you to live workshops.
            .modal-footer
              button(type="button", class="btn btn-default", data-dismiss="modal") Close

    script(type="text/ng-template" id="/templates/#{template.name}").
      !{template.html}

    script(type="text/ng-template" id="/templates/#{chatTemplate.name}").
      !{chatTemplate.html}

    script(type="text/javascript").
      window.session = {
        firebase: !{ firebase ? JSON.stringify(firebase) : 'null' },
        user: !{ session ? JSON.stringify(session) : 'null'},
        workshop: !{ workshop ? JSON.stringify(workshop) : 'null'},
        requestId: !{ workshopRequestId ? JSON.stringify(workshopRequestId) : 'null'},
        registration: !{ registration ? JSON.stringify(registration) : 'null'},
        attendees: !{ attendees ? JSON.stringify(attendees) : '[]'},
        attendingWorkshops: !{ attendingWorkshops ? JSON.stringify(attendingWorkshops) : '[]'}
      };

      function bindLoginModal() {
        if(typeof addjs === 'undefined') {
          var AddJS = require("scripts/providers/addjs/index");
          window.addjs = new AddJS('!{segmentioKey}');
        }
        addjs.trackEvent('page', 'view', window.location.pathname, 'workshop detail');
        addjs.trackSession({});

        $("body").on('click', ".loginRequired", function(e) {
          e.preventDefault();
          var return_to = window.location.pathname;
          if ($(this).data('return')) { return_to = $(this).data('return'); }

          elemId = window.location.pathname + ':' + $(this).attr('id');
          addjs.trackEvent('airconf', 'airconfExplore', elemId);
          $('#loginModal').modal({ keyboard: false });
          $(".trackAirConfLogin").click(function(e) {
            addjs.trackEvent('airconf', 'airconfLogin', elemId);
            addjs.redirectToLogin(e, "auth/google?return_to=" + return_to);
          });
        });
      }
      bindLoginModal();

      require('scripts/site/workshop');
