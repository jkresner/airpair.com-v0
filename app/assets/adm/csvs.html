<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>airpair</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/stylesheets/app.css">
    <link rel="stylesheet" href="/stylesheets/admin.css">
</head>

<body id="admtagspage">

  <nav>
    <div>
      <a href="/" class="logo"></a>
      <ul>
        <li><a href="/adm/inbound" class="zocial">Inbound</a></li>
        <li><a href="/adm/orders" class="zocial">Orders</a></li>
        <li><a href="/adm/tags" class="zocial">Tags</a></li>
        <li><a href="/adm/marketingtags" class="zocial">Marketing</a></li>
        <li><a href="/adm/experts" class="zocial">Experts</a></li>
        <li><a href="/adm/companys" class="zocial">Companys</a></li>
        <li><a href="/adm/csvs" class="zocial">CSVs</a></li>
        <li><a href="https://plus.google.com/hangouts/_?hso=0&gid=140030887085" class="zocial googleplus" target="_blank">Hangout &nbsp;</a></li>
      </ul>
    </div>
  </nav>

  <div class="main" style="width:80%">

    <h2>Users</h2>
    <textarea id="users" style="width:100%;height:400px;font-size:9px;line-height:14px"></textarea>

    <h2>Experts</h2>
    <textarea id="experts" style="width:100%;height:400px;font-size:9px;line-height:14px"></textarea>

    <h2>Customers</h2>
    <textarea id="customers" style="width:100%;height:400px;font-size:9px"></textarea>

  </div>

</body>

  <script src="/javascripts/vendor.js"></script>
  <script type="text/javascript">

      $(function () {
        $log('loaded')

        $.ajax({ url: "/api/experts" }).done(function ( data ) {
          window.experts = data;
          i = 0;
          csv = '#\tname\temail\ttags\n';
          _.each(data, function(d) {
            i++;
            csv += i + '\t' + d.name + '\t' + d.email + '\n';
          });

          $('#experts').val(csv);
        });

        $.ajax({ url: "/api/admin/requests" }).done(function ( data ) {
          window.requests = data;
          csv = '#\tcompany\temail\tname\n';
          i = 0;
          _.each(data, function(d) {
            i++;

            csv += i + '\t' + d.company.name + '\t' + d.company.contacts[0].email
              + '\t' + d.company.contacts[0].fullName
              + '\n';
          });

          $('#customers').val(csv);
        });


        $.ajax({ url: "/api/admin/users" }).done(function ( data ) {
          window.users = data;
          i = 0;
          csv = '#\tname\temail\n';
          _.each(data, function(d) {
            if (d.google)
            {
              i++;
              g = d.google._json
              csv += i + '\t' + g.name + '\t' + g.email  + '\n';
            }
          });

          $('#users').val(csv);
        });

      });

      function findUserByName(name) {
        usr = _.find(users,function(u) {
          if (u.google)
          {
            return u.google.displayName == name;
          }
          else
          {
            return false;
          }
        });

        if (usr)
        {
          if (usr.google) delete(usr.google.token)
          if (usr.twitter) delete(usr.twitter.token)
          if (usr.github) delete(usr.github.token)
          if (usr.linkedin) delete(usr.linkedin.token)
          if (usr.stack) delete(usr.stack.token)
          if (usr.bitbucket) delete(user.bitbucket.token)
        }

        return JSON.stringify(usr);
      }

  </script>

</html>
